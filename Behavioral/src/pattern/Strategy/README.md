## 策略（Strategy）模式 ##

策略模式属于对象的行为模式。其用意是针对一组算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换。

策略模式使得算法可以在不影响客户端的情况下发生变化。

对于一段复杂的业务逻辑算法，解决方案有如下三种：

* 所有的业务逻辑都放在客户端里面。客户端利用条件选择语句决定使用哪一个算法。这样一来，客户端代码会变得复杂和难以维护。

* 客户端可以利用继承的方法在子类里面实现不同的行为，但是这样会使得环境和行为紧密耦合在一起。强耦合会使两者都不能单独演化。

* 使用策略模式。策略模式把行为和环境分割开来。环境类负责维持和查询行为类，各种算法则在具体策略类中提供。由于算法和环境独立开来，算法的增减、修改都不会影响环境和客户端。


当准备在一个系统里使用策略模式时，首先必须找出需要包装的算法，看看算法是否可以从环境中分割开来，最后再考察这些算法是否会在以后发生变化。

策略模式是对算法的包装，是把使用算法的责任和算法本身分割开，委派给不同的对象管理。策略模式通常把一个系列的算法包装到一系列的策略类里面，作为一个抽象策略类的子类。用一句话来说，就是“准备一组算法，并将每一个算法封装起来，使得它们可以互换。”


策略模式又称作政策（Policy）模式，涉及三个角色：

环境角色、抽象策略角色、具体策略角色。


### 为什么不能从策略模式中看出哪一个具体策略适用于哪一种情况？

策略模式并不负责做这个决定。换言之，应当由客户端自己决定在什么情况下使用什么具体策略角色。策略模式仅仅封装算法，提供新算法插入到已有系统中，以及老算法从系统中退休的方便，所以它并不决定在何时使用何种算法。


### 同时嵌套使用多于一个的算法

策略模式不适合于处理同时嵌套多于一个算法的情形。一般而言，策略模式只适用于客户端在几种算法中选择一种的情形，并不适用于客户端同时需要几种算法的情形，这时就需要进一步使用装饰模式。


在下面的情况下应当考虑使用策略模式：

* 如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态的让一个对象在许多行为中选择一种行为。

* 一个系统需要动态的在几种算法中选择一种，那么这些算法可以包装到一个个的具体算法类里面，而这些具体算法类都是一个抽象算法类的子类。这些具体算法类均有统一的接口，由于多态性原则，客户端可以选择使用任何一个具体算法类，并只持有一个数据类型是抽象算法类的对象。

* 一个系统的算法使用的数据不可以让客户端知道。策略模式可以避免让客户端涉及到不必要接触到的、复杂的、只与算法有关的数据。

* 如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。此时，使用策略模式，把这些行为转移到相应的具体策略类里面，就可以避免使用难以维护的多重条件选择语句，并体现面向对象设计的概念。


### 策略模式的优点

* 策略模式提供了管理相关的算法族的方法，策略类的等级结构定义了一个算法或行为族。
恰当使用继承可以把公共的代码移到父类里面，从而避免重复的代码。

* 策略模式提供了可以替换继承关系的方法。继承可以处理多种算法或行为，如果不是用策略模式，那么使用算法或行为的环境类就可能会有一些子类，每一个子类提供一个不同的算法或行为。但是，这样一来算法或行为的使用者就和算法或行为本身混在一起。决定使用哪一种算法或采取哪一种行为的逻辑就和算法或行为的逻辑混合在一起，从而不可能再独立演化。继承使得动态改变算法或行为变得不可能。

* 使用策略模式可以避免使用多重条件转移语句。多重转移语句不易维护，它把采取哪一种算法或采取哪一种行为的逻辑与算法或行为的逻辑混合在一起，统统列在一个多重转移语句里面，比使用继承的方法还要原始和落后。


### 策略模式的缺点

* 客户端必须知道所有的策略类，并自行决定使用哪一个策略类。这就意味着客户端必须理解这些算法的区别，以便适时选择恰当的算法类。换言之，策略模式只适用于客户端知道所有的算法或行为的情况。

* 策略模式造成很多的策略类。有时候可以通过把依赖于环境的状态保存到客户端里面，而将策略类设计成共享的，这样策略类实例可以被不同客户端使用。换言之，可以使用享元模式来减少对象的数量。


JDK 中使用了策略模式的例子有：

* AWT中的LayoutManager

	环境（Context）角色：Container。

	抽象策略（Strategy）角色：LayoutManager。

	具体策略（ConcreteStrategy）角色：BorderLayout、FlowLayout、GridLayout等等。

* Swing中的Border

	环境（Context）角色：JContainer。

	抽象策略（Strategy）角色：Border。

	具体策略（ConcreteStrategy）角色：TitledBorder、LineBorder、EtchedBorder等等。


JDK里的应用：

	java.util.Comparator#compare()
	javax.servlet.http.HttpServlet
	javax.servlet.Filter#doFilter()
